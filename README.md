## Building Model

Once NEURON is installed, set the `PATH` and `PYTHONPATH ` environment variables as follows:

```
export PYTHONPATH=$HOME/install/lib/python:$PYTHONPATH
export PATH=$HOME/install/bin:$PATH
```

As in a typical NEURON workflow, use `nrnivmodl` to translate MOD files:

```
nrnivmodl mod_directory
```

## Running Simulations

### Training (online) phase

Run the training (online) phase simulation as follows:

	mpirun -n <nprocs> python3 run_training.py \
        --model-home $PWD \
        --circuit-config circuitparams_segs_eegrad_stdp_ee_ie_mf_mec_lec.yaml \
        --arena-config arenaparams_uniform.yaml \
        -c 1229_segs_eegrad_stdp_ee_ie_mf_mec_lec_input_uniform \
        --data-prefix <output_dir> \
        --save-weights-every <n>
	
where:
- `--model-home $PWD` : specifies the directory where the model code is located. $PWD indicates the current directory.
- `--circuit-config ...` : indicates the name of the circuit configuration file. Circuit configuration files are located in subdirectory `params` by default.
- `--arena-config ...` : indicates the name of the arena configuration file, which specifies the input stimulus settints. Circuit configuration files are located in subdirectory `params` by default.
- `-c <label>` : specifies a label for this model configuration. The label will be used to generate the names of the output files.
- `--data-prefix <output-dir>` : Optional argument to specify the directory where output files will be written. If not specified, the default is subdirectory `data`.
- `--save-weights-every <n>` : Optional argument to specify that weights are saved every n-th lap. If not specified, weights are saved at the end of all laps.

The run_training script generates the following output files:

- `cell_spikes_<config name>.npz`: spikes produces by the biophysicial neurons in the model.
- `ext_spikes_<config name>.npz`: spikes produces by the artificial spike sources in the model.
- `v_vecs_<config name>.npz`: somatic voltage traces of all biophysical neurons in the model.
- `<config name>-nlaps-<nlap>.npz`: synaptic weights at the end of lap `nlap`.

### Offline phase

Run the online phase simulation as follows:

	mpirun -n <nprocs> python3 run_ripple.py \
            --model-home $PWD \
            --circuit-config circuitparams_ripple.yaml \
            --arena-config arenaparams_ripple_uniform_high.yaml \
            -c ripple_1229_segs_eegrad_stdp_ee_ie_mf_mec_lec_input_uniform \
            --saved-weights-path data/<saved weights file>
  
where:
- `--model-home $PWD` : specifies the directory where the model code is located. $PWD indicates the current directory.
- `--circuit-config ...` : indicates the name of the circuit configuration file. Circuit configuration files are located in subdirectory `params` by default.
- `--arena-config ...` : indicates the name of the arena configuration file, which specifies the input stimulus settints. Circuit configuration files are located in subdirectory `params` by default.
- `-c <label>` : specifies a label for this model configuration. The label will be used to generate the names of the output files.
- `--data-prefix <output-dir>` : Optional argument to specify the directory where output files will be written. If not specified, the default is subdirectory `data`.
- `--saved-weights-path <path>` : Location of weights file generated by training run.



The run_ripple script generates the following output files:

- `cell_spikes_<config name>.npz`: spikes produces by the biophysicial neurons in the model.
- `ext_spikes_<config name>.npz`: spikes produces by the artificial spike sources in the model.
- `v_vecs_<config name>.npz`: somatic voltage traces of all biophysical neurons in the model.

## Analysis

See notebook [analysis.ipynb](notebooks/analysis.ipynb)

